% !TeX TS-program = pdflatex
% !BIB TS-program = biber
\documentclass[aspectratio=169,professionalfonts]{beamer}
\input{config}
\input{meta}
\input{tikz/config}
\begin{document}
% ------------------------------------------------------------------------------
\begin{frame}
  \maketitle
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Outline}
  \begin{itemize}
    \item Reproduction Number $R$
    \item Estimating $R$
    \item Estimating Generation Time Distribution $G(\tau)$
    \item Results
    \item Implications
  \end{itemize}
\end{frame}
% ==============================================================================
\section{Background}
% ------------------------------------------------------------------------------
\begin{frame}{Reproduction Number: Defined}
  Average number of secondary infections
  generated by each infectious individual
  \par
  \pause
  \centering\input{tikz/R=123}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Basic $R_0$ and Effective $R_e(t)$}
  \begin{minipage}{0.6\linewidth}
    \begin{align*}
      \visible<1->{
        R_0    &= \beta \cdot C \cdot D}\\
      \visible<5->{
        R_e(t) &= \beta_t \cdot C_t \cdot D_t \cdot \hat{S}(t)}
    \end{align*}
    \begin{itemize}
      \item<2-> $\beta$ = probability of transmission per contact
      \item<3-> $C$ = contact rate
      \item<4-> $D$ = duration of infectiousness
      \item<6-> $\hat{S}$ = proportion who are susceptible
    \end{itemize}
  \end{minipage}%
  \begin{minipage}{0.4\linewidth}
    \visible<7>{\centering\input{tikz/R=3-2}}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{$R_0$ for Common Diseases}
  \centering
  \input{tab/R0-diseases}\quad
  \parbox{0.4\linewidth}{
    \begin{itemize}
      \item Without interventions
      \item Context-specific: $\beta \cdot C \cdot D$
  \end{itemize}}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Applications of $R$}
  \begin{itemize}
    \pause
    \item Measure of epidemic ``potential''
    \pause
    \item Monitor interventions
    \pause
    \item Required vaccine coverage:
    \begin{equation*}
      V = 1 - \frac{1}{R_0}
    \end{equation*}
  \end{itemize}
\end{frame}
% ==============================================================================
\section{Methods}
% ------------------------------------------------------------------------------
\begin{frame}{Estimating $R$:\enspace3 Methods}
  \begin{itemize}
    \item Static exponential: $R_0$
    \item Renewal equation: $R_e(t)$
    \item Mechanistic models (not covered)
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Exponential Model for $R_0$}
  \begin{minipage}{0.5\linewidth}
    \begin{align*}
      I(t) &= I_0 \cdot e^{\alpha t} \\
      \visible<3->{
        R_0  &= \frac{I(t+g)}{I(t)} = e^{\alpha g}}
    \end{align*}
    \begin{itemize}
      \item $I$ = infections
      \item $\alpha$ = exponential growth rate
      \item<2-> $g$ = generation time:\\
      \hspace{1.7em}time between infections
    \end{itemize}
  \end{minipage}%
  \begin{minipage}{0.5\linewidth}
    \centering
    \input{tikz/exp-data}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Exponential Model: Assumptions}
  \begin{minipage}{0.5\linewidth}
    \heading{Assumptions:} % TODO
    \begin{itemize}
      \item Homogeneous susceptible population
      \item Constant $R_0$
      \item Reported cases $\,\propto\,$ true cases
    \end{itemize}
    \vspace{1em}
    \heading{If longer generation time \textit{g}:}
    \begin{itemize}
      \item Expect slower epidemic growth
      \item Infer \emph{greater} $R_0$
    \end{itemize}
  \end{minipage}%
  \begin{minipage}{0.5\linewidth}
    \centering
    \input{tikz/exp-data}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Renewal Equation for $R_e(t)$}
  \invisible{\footcite{Fraser2007,Cori2013}}
  Similar to exponential model, but with generation time \emph{distribution}: $g \sim G(\tau)$
  \pause
  \begin{align*}
    I(t) &= R_e(t) \int_{t_0}^t I(t-\tau) G(\tau) d\tau\\
    \visible<3->{
      R_e(t) &= I(t) {\left[\int_{t_0}^{t}{I(t-\tau) G(\tau) d\tau}\right]}^{-1}}
  \end{align*}
  \begin{itemize}
    \item $I(t-h)$ = infections $\tau$ days ago
    \item $G(\tau)$ = infectiousness $\tau$ days since infection
    \item $t_0 = t-w$, integration window
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Renewal Equation: Illustrated}
  \begin{minipage}{0.6\linewidth}
    \centering\input{tikz/Re-toy}
  \end{minipage}%
  \begin{minipage}{0.4\linewidth}
    \pause\pause
    \heading{Assumptions:}
    \begin{itemize}
      \item Same as exponential
      \item Constant $R_e$ over each window
    \end{itemize}
    \pause
    \vspace{1em}
    \heading{Moving window $\mathbf{\rightarrow  R_e(t)}$}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{$R_e(t)$: Examples}
  \includegraphics[width=\linewidth]{Cori2013}
  \invisible{\footcite{Cori2013}}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Infectiousness: Serial Interval $S(\tau)$}
  \begin{minipage}[t]{0.5\linewidth}
    \centering
    1. Known case-pairs:
    \\[1em]
    \input{tab/case-pairs}
  \end{minipage}\pause%
  \begin{minipage}[t]{0.5\linewidth}
    \centering
    2. Fit a distribution:
    \\[1em]
    \input{tikz/serial}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Infectiousness: Serial Interval vs Generation Time}
  \vspace{1em}
  \centering\input{tikz/gen-time}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Recovering the Generation Time Distribution}
  Random variables:
  \begin{equation*}
    \left.
    \begin{aligned}
      g_i &= [f_{i+1} - f_{i}] &&\sim G(\tau) \\
      s_i &= [s_{i+1} - s_{i}] &&\sim S(\tau) \\
      h_i &= [s_{i}   - f_{i}] &&\sim H(\tau) \\
    \end{aligned}
    \visible<2->{\enspace\right\}\enspace}
    \begin{aligned}\\
      \visible<2->{s_i &= g_{i} + h_{i+1} - h_{i}}\\
      \visible<3->{    &\sim G(\tau) \conv H(\tau) \conv H(-\tau)}
    \end{aligned}
  \end{equation*}
  \pause\pause
  \invisible{\footcite{Hogg2005}}
  where $\conv$ is convolution.\pause Thus:
  \begin{equation*}
    G(\tau) = \big[S(\tau) \iconv H(\tau)\big] \iconv H(-\tau)
  \end{equation*}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Practical Deconvolution}
  \begin{itemize}
    \item True deconvolution: unstable
    \item Solution: assume parametric $\hat{G}(\tau)$:
    \begin{equation*}
      \hat{G}(\tau\,|\,\theta) \sim \mathsf{Gamma}(\tau\,|\,\theta)
    \end{equation*}
    \pause
    \item Estimate $\theta$ to minimize:
    \begin{equation*}
      D_{KL} \Big( S(\tau) \,\Big|\Big|\, \hat{S}(\tau\mid\theta) \Big)
      ,\quad
      \hat{S}(\tau\,|\,\theta) = \hat{G}(\tau\,|\,\theta) \conv H(\tau) \conv H(-\tau)
    \end{equation*}
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Estimating $G(\tau)$: Data}
  \heading{What is the Generation Time distribution for \covid?}
  \begin{itemize}
    \item Serial interval: \textcite{Du2020}, $N = 468$
    \begin{equation*}
      S(\tau) \sim \mathsf{Norm\,(\mu=3.96, \sigma=4.75)}
    \end{equation*}
    \item Incubation period: \textcite{Lauer2020}, $N = 181$
    \begin{equation*}
      H(\tau) \sim \mathsf{Gamma}\,(\alpha=5.81, \beta=0.95)
    \end{equation*}
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{\covid \& Pre-symptomatic Transmission}
  \begin{itemize}
    \item Pre-symptomatic transmission $\rightarrow$ $S(\tau)$ can be negative
    \item However: $G(\tau)$ must be non-negative
  \end{itemize}
  \pause
  \heading{Popular R package \texttt{EpiEstim}}
  \begin{itemize}
    \item Estimates $R_e(t)$ by renewal equation
    \item Input: ``serial interval'', but must be non-negative
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Estimating $R_e(t)$: Data}
  \heading{What is the potential bias in $R_e(t)$ using $S(\tau)$ vs $G(\tau)$?}
  \begin{itemize}
    \item $I(t)$: \covid in GTA during March--April 2020\\[1em]
    \pause
    \item $G(\tau)$: ``recovered''\\[1em]
    \item $S(\tau)$: from literature:
    \begin{itemize}
      \item $\mathsf{Norm\,(\mu=3.96, \sigma=4.75)}$    \ttl{.35}\textcite{Du2020}\ttl{.6}Negative permitting
      \item $\mathsf{Gamma\,(\alpha=3.62, \beta=1.42)}$ \ttl{.35}\textcite{Zhang2020}\ttl{.6}Non-Negative
      \item $\mathsf{LogN\,(\mu=4.7, \sigma=2.9)}$      \ttl{.35}\textcite{Nishiura2020}\ttl{.6}Non-Negative
    \end{itemize}
  \end{itemize}
  \invisible{\footcite{Knight2020}}
\end{frame}
% ==============================================================================
\section{Results}
% ------------------------------------------------------------------------------
\begin{frame}{Recovered Generation Time Distribution}
  \begin{minipage}{0.65\linewidth}
    \includegraphics[width=\linewidth]{deconv}
  \end{minipage}\hfill%
  \begin{minipage}{0.33\linewidth}
    \pause
    $\hat{G}(\tau\,|\,\alpha,\beta)$\\
    $\sim \mathsf{Gamma}\,(\alpha=1.63,\beta=2.50)$
    \vspace{1em}
    \begin{itemize}
      \item mean: \ttl{.25} 4.08 \ttl{.5}$\approx$ 3.98
      \item SD:   \ttl{.25} 3.19 \ttl{.5}$<$ 4.75
    \end{itemize}
  \end{minipage}%
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Generation Time vs Serial Interval Distributions}
    \begin{minipage}{0.65\linewidth}
    \includegraphics[width=\linewidth]{distr-refs}
  \end{minipage}\hfill%
  \begin{minipage}{0.33\linewidth}
    \setlength{\tabcolsep}{3pt}
    \begin{tabular}{lcll}
      \toprule
      Ref.     & Dist. & Mean & SD \\
      \midrule
      Du       & $S(\tau)$ & 3.96 & 4.75 \\
      Zhang    & $S(\tau)$ & 5.1 & 2.7 \\
      Nishiura & $S(\tau)$ & 4.7 & 2.9 \\
      (this)   & $G(\tau)$ & 4.08 & 3.19 \\
      \bottomrule
    \end{tabular}
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{\covid Infections $I(t)$ in GTA}
  \begin{minipage}{0.65\linewidth}
    \includegraphics[width=\linewidth]{cases}
  \end{minipage}\hfill%
  \begin{minipage}{0.33\linewidth}
    
  \end{minipage}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{$R_e(t)$ using $S(\tau)$ vs $G(\tau)$}
  \begin{minipage}{0.65\linewidth}
    \includegraphics[width=\linewidth]{Re}
  \end{minipage}\hfill%
  \begin{minipage}{0.33\linewidth}
    \pause
    Compared to $G(\tau)$:
    \begin{itemize}
      \visible<3->{\item {\color{teal}Non-Negative} $S(\tau)$:\\
      \textbf{overestimate} $R_e(t)$\\
      due to: larger mean}
      \visible<4->{\item {\color{red}Negative-Permitting} $S(\tau)$:\\
      \textbf{underestimate} $R_e(t)$\\
      due to: larger variance}
    \end{itemize}
  \end{minipage}
\end{frame}
% ==============================================================================
\section{Implications}
% ------------------------------------------------------------------------------
\begin{frame}{Implications}
  \pause
  \heading{1. Characterized generation time distribution for \covid}
  \begin{itemize}
    \item Generation time\ \ =\ \ distribution of infectiousness (after exposure)
  \end{itemize}
  \pause
  \heading{2. New method to infer $G(\tau)$ from $S(\tau)$}
  \begin{itemize}
    \item Applicable to other infections
  \end{itemize}
  \pause
  \heading{3. Illustrated potential bias in $R_e(t)$ using $S(\tau)$ vs $G(\tau)$}
  \begin{itemize}
    \item Non-negative $S(\tau)$: overestimate $R_e(t)$
    \item Negative-permitting $S(\tau)$: underestimate $R_e(t)$
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Limitations}
  \begin{itemize}
    \pause
    \item Assumed independent distributions $G(\tau)$, $S(\tau)$, $H(\tau)$
    \pause
    \item Parametric approximations\\
          However: useful for meta-analyses
    \pause
    \item No uncertainty analysis / confidence intervals
  \end{itemize}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Thanks}
  \centering\footnotesize
  \heading{\large Funding}\\
  \begin{tabularx}{\linewidth}{CCC}
    \includegraphics[height=0.10\textheight]{nserc} &
    \includegraphics[height=0.10\textheight]{on} &
    \includegraphics[height=0.08\textheight]{smh} \\
    Canada Graduate Scholarship--D & Ontario Early Researcher Award & 2020 \covid Research Award
  \end{tabularx}
  \vfill
  \heading{\large Support}\\
  \begin{tabularx}{.5\linewidth}{CC}
    \includegraphics[height=0.12\textheight]{uoft} &
    \includegraphics[height=0.10\textheight]{map}
  \end{tabularx}
  \vfill
  Kristy Yiu, Linwei Wang, Huiting Ma, David Landsman, \textit{Unity Health Toronto}\\
  David Champredon, \textit{University of Western Ontario}\\
  Elena Aruffo, Jude Dzevela Kong, \textit{CAIMS 2021 Mini Symposium Organizers}
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{References}
  \printbibliography[heading=none]
\end{frame}
% ------------------------------------------------------------------------------
\begin{frame}{Preliminary Uncertainty Analysis}
  \begin{minipage}{0.65\linewidth}
    \centering
    \includegraphics[height=.85\textheight]{uncertainty}
  \end{minipage}\hfill%
  \begin{minipage}{0.33\linewidth}
    Likelihood of $\alpha, \beta$ for $\hat{G}(\tau)$\\
    from ``deconvolution''
  \end{minipage}
\end{frame}
% ==============================================================================
\end{document}